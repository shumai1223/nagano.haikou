<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>長野の廃校殲滅計画！</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts - Inter for modern look, Noto Sans JP for Japanese text -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Custom CSS to override/enhance Tailwind and provide global styles */
    html {
      scroll-behavior: smooth; /* スムーズスクロールを有効にする */
    }
    body {
      font-family: 'Noto Sans JP', 'Inter', sans-serif;
      background: linear-gradient(to bottom right, #1a1a2e, #16213e, #0f3460); /* 深い青から紫へのグラデーション */
      color: #e0e7ff; /* 明るいオフホワイトの文字色 */
      overflow-x: hidden;
      line-height: 1.7; /* 行間を広げて読みやすく */
    }
    body.menu-open {
        overflow: hidden; /* モバイルメニュー表示時に背景をスクロールさせない */
    }

    h1, h2, h3, h4 {
      font-family: 'Inter', 'Noto Sans JP', sans-serif;
      color: #a7f3d0; /* アクセントカラーの薄い緑 */
      font-weight: 700;
    }

    /* Header specific styles */
    header {
      background: linear-gradient(90deg, #0f3460, #16213e); /* ヘッダーのグラデーション */
      padding: 80px 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
      border-bottom-left-radius: 50px; /* 左下を丸く */
      border-bottom-right-radius: 50px; /* 右下を丸く */
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }
    header::before {
      content: '';
      position: absolute;
      top: -50px;
      left: -50px;
      width: 200px;
      height: 200px;
      background: rgba(167, 243, 208, 0.1);
      border-radius: 50%;
      filter: blur(50px);
      animation: pulse 8s infinite alternate;
    }
    header::after {
      content: '';
      position: absolute;
      bottom: -50px;
      right: -50px;
      width: 150px;
      height: 150px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      filter: blur(40px);
      animation: pulse 10s infinite alternate-reverse;
    }
    header h1 {
      font-size: 4.5em; /* さらに大きく */
      margin-bottom: 15px;
      color: #e0e7ff; /* 白に近い色 */
      text-shadow: 3px 3px 10px rgba(0,0,0,0.5); /* 影を強調 */
      opacity: 0; /* Initial state for animation */
      transform: translateY(-20px); /* Initial state for animation */
      animation: slideInTop 1s ease-out forwards; /* Apply slide-in animation */
    }
    header p {
      font-size: 1.6em; /* さらに大きく */
      color: #bfdbfe; /* 薄い青 */
      opacity: 0; /* Initial state for animation */
      transform: translateY(20px); /* Initial state for animation */
      animation: slideInBottom 1s ease-out 0.5s forwards; /* Apply slide-in animation with delay */
    }

    /* Navigation specific styles */
    nav {
      background: rgba(15, 52, 96, 0.95); /* ナビゲーションの背景を少し濃く */
      padding: 18px 20px; /* 左右にパディングを追加 */
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(167, 243, 208, 0.2);
      display: flex; /* Flexboxでアイテムを配置 */
      justify-content: center; /* 中央揃え */
      align-items: center;
    }
    #desktop-nav {
      display: none; /* モバイルでは非表示 */
    }
    #desktop-nav a { /* デスクトップナビゲーションリンクのスタイル */
      color: #bfdbfe;
      text-decoration: none;
      margin: 0 15px; /* マージンを調整 */
      font-weight: 500;
      font-size: 1.1em; /* フォントサイズを微調整 */
      white-space: nowrap; /* テキストの折り返しを防ぐ */
      transition: all 0.3s ease;
      padding: 8px 10px; /* パディングを調整 */
      border-radius: 8px;
      outline-offset: 4px; /* フォーカス時のアウトラインのオフセット */
      outline: 2px solid transparent; /* デフォルトのアウトラインを透明に */
    }
    #desktop-nav a:hover {
      transform: translateY(-3px) scale(1.05);
      color: #a7f3d0;
      background: rgba(167, 243, 208, 0.1);
      box-shadow: 0 0 15px rgba(167, 243, 208, 0.3);
      text-shadow: 0 0 8px #a7f3d0; /* Add text shadow for glow effect */
    }
    #desktop-nav a:focus-visible { /* キーボードフォーカス時のスタイル */
      outline: 2px solid #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.5), 0 0 15px rgba(167, 243, 208, 0.5); /* Enhanced glow on focus */
    }

    /* Main content specific styles */
    main {
      max-width: 1100px;
      margin: 40px auto;
      padding: 40px 20px;
      background: rgba(22, 33, 62, 0.7); /* メインコンテンツの背景 */
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(167, 243, 208, 0.1);
      transition: background 0.5s ease; /* 管理画面切り替え時の背景変化を滑らかに */
    }
    section {
      margin-bottom: 80px;
      padding: 30px; /* パディングを少し増やす */
      border-radius: 15px;
      background: rgba(15, 52, 96, 0.3); /* セクションの背景 */
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(167, 243, 208, 0.05);
    }
    /* === 小タイトルのスタイルを更新 === */
    h2 {
      font-size: 6.5em; /* フォントサイズをさらに大きく */
      color: #e0e7ff; /* 基本色を白寄りに変更 */
      padding-left: 15px; /* 左側にパディングを追加 */
      margin-bottom: 50px; /* 余白を増やす */
      text-shadow: 0 0 8px rgba(167, 243, 208, 0.6), 0 0 20px rgba(167, 243, 208, 0.4); /* グロー効果を強調 */
      position: relative;
      border-left: 8px solid #a7f3d0; /* 左側に縦線を追加 */
      border-right: none; /* 右側の縦線は削除 */
      padding-right: 0; /* 右側のパディングも削除 */
    }
    /* 左側の縦線を削除するため、h2::before を削除 */
    p {
      color: #e0e7ff;
      font-size: 1.15em; /* フォントサイズを少し大きく */
      margin-bottom: 15px; /* 段落下の余白 */
    }
    /* === 箇条書きのスタイルを更新 === */
    section ul {
      list-style: disc; /* 標準のディスクマーカーを使用 */
      margin-left: 25px; /* 左側のマージンでインデント */
      color: #e0e7ff;
      font-size: 1.1em;
    }
    section li {
      margin-bottom: 12px; /* リストアイテム間の余白 */
      padding-left: 10px; /* マーカーとのスペースを調整 */
    }

    /* Team section */
    .team {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* グリッドレイアウト */
      gap: 30px;
    }
    .member {
      background: #1a2a4e; /* メンバーカードの背景 */
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.6);
      padding: 25px;
      transition: all 0.3s ease;
      border: 1px solid rgba(167, 243, 208, 0.15);
      text-align: center;
    }
    .member:hover {
      transform: translateY(-12px) scale(1.02);
      background: #243c68; /* Slightly different hover color */
      box-shadow: 0 15px 35px rgba(0,0,0,0.8), 0 0 15px (167, 243, 208, 0.3); /* Subtle glow */
    }
    .member h4 {
      font-size: 1.7em; /* 少し大きく */
      color: #a7f3d0;
      margin-bottom: 10px;
    }
    .member p {
      font-size: 1.05em;
      color: #bfdbfe;
    }

    /* Idea blocks */
    .idea {
      background: rgba(26, 42, 78, 0.8);
      border-left: 6px solid #a7f3d0;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 25px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.4);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .idea:hover {
      transform: translateX(5px) scale(1.01); /* ホバー効果を強調 */
      box-shadow: 0 8px 25px rgba(0,0,0,0.5), 0 0 20px rgba(167, 243, 208, 0.6); /* More prominent glow */
    }
    .idea h3 {
      font-size: 1.9em; /* 少し大きく */
      color: #e0e7ff;
      margin-bottom: 10px;
    }
    .idea p {
      font-size: 1.15em; /* 少し大きく */
      color: #bfdbfe;
    }

    /* Contact form */
    form {
      background: #1a2a4e;
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
      border: 1px solid rgba(167, 243, 208, 0.15);
    }
    input[type="text"],
    input[type="email"],
    input[type="password"], /* パスワード入力フィールド用 */
    textarea {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 20px;
      border: 1px solid #3b5998; /* 入力欄のボーダー色 */
      border-radius: 10px;
      background: #111a2d; /* 入力欄の背景色 */
      color: #e0e7ff;
      font-size: 1.05em;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      outline: 2px solid transparent; /* デフォルトのアウトラインを透明に */
      outline-offset: 2px;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus, /* パスワード入力フィールド用 */
    textarea:focus {
      outline: none;
      border-color: #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.3), 0 0 10px rgba(167, 243, 208, 0.5); /* Add glow on focus */
    }
    input[type="submit"],
    .btn-primary { /* ボタン共通スタイル */
      background: #a7f3d0; /* 送信ボタンの背景 */
      color: #0f3460; /* 送信ボタンの文字色 */
      border: none;
      padding: 12px 30px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1em;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.4);
      outline: 2px solid transparent; /* デフォルトのアウトラインを透明に */
      outline-offset: 4px;
    }
    input[type="submit"]:hover,
    .btn-primary:hover {
      background: #7bdcb5; /* ホバー時の背景色 */
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.5);
    }
    input[type="submit"]:focus-visible,
    .btn-primary:focus-visible { /* キーボードフォーカス時のスタイル */
      outline: 2px solid #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.5);
    }
    input[type="submit"]:active, /* Add active state for primary buttons */
    .btn-primary:active {
      transform: translateY(0px) scale(0.98); /* Slightly shrink on click */
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
    }

    .btn-secondary { /* 管理画面用セカンダリボタン */
      background: #3b5998;
      color: #e0e7ff;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      outline: 2px solid transparent;
      outline-offset: 3px;
    }
    .btn-secondary:hover {
      background: #4a6fa5;
      transform: translateY(-1px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .btn-secondary:focus-visible {
      outline: 2px solid #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.5);
    }
    .btn-secondary:active { /* Add active state for secondary buttons */
      transform: translateY(0px) scale(0.98); /* Slightly shrink on click */
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* Loading Button Styles */
    .btn-loading {
      cursor: wait !important;
      pointer-events: none; /* Prevents multiple clicks */
      color: transparent !important; /* Hide button text */
      position: relative;
    }

    .btn-loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 24px; /* Increased size */
      height: 24px; /* Increased size */
      margin-top: -12px; /* Center vertically */
      margin-left: -12px; /* Center horizontally */
      border: 3px solid #fff; /* Thicker border */
      border-top-color: #a7f3d0; /* Accent color for the top part */
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    /* Footer */
    footer {
      background: #0f3460;
      color: #bfdbfe;
      text-align: center;
      padding: 25px;
      font-size: 0.95em;
      margin-top: 60px;
      border-top-left-radius: 50px;
      border-top-right-radius: 50px;
      box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.4);
    }

    /* Scroll to top button */
    #scrollToTopBtn {
      display: none; /* Hidden by default */
      position: fixed; /* Fixed position */
      bottom: 30px; /* Place at the bottom */
      right: 30px; /* Place at the right */
      z-index: 999; /* Higher z-index to be on top */
      background-color: #a7f3d0; /* Button background */
      color: #0f3460; /* Button text color */
      border: none;
      border-radius: 50%; /* Make it round */
      width: 50px;
      height: 50px;
      font-size: 1.5em;
      font-weight: bold;
      line-height: 50px; /* Vertically center content */
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.4);
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s, opacity 0.3s;
      opacity: 0.8;
      outline: 2px solid transparent; /* デフォルトのアウトラインを透明に */
      outline-offset: 4px;
    }
    #scrollToTopBtn:hover {
      background-color: #7bdcb5;
      transform: scale(1.1);
      opacity: 1;
    }
    #scrollToTopBtn:focus-visible {
      outline: 2px solid #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.5);
    }

    /* === Mobile Menu Styles === */
    #hamburger-btn {
        position: fixed;
        top: 18px;
        right: 20px;
        z-index: 1002;
        background: none;
        border: none;
        padding: 10px;
        cursor: pointer;
        display: none; /* JS will manage this */
    }
    .hamburger-line {
        display: block;
        width: 30px;
        height: 3px;
        background-color: #e0e7ff;
        border-radius: 3px;
        margin: 6px 0;
        transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1), background-color 0.4s ease;
    }
    #hamburger-btn.is-active .hamburger-line:nth-child(1) {
        transform: rotate(45deg) translate(7px, 7px);
    }
    #hamburger-btn.is-active .hamburger-line:nth-child(2) {
        transform: scaleX(0);
    }
    #hamburger-btn.is-active .hamburger-line:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -7px);
    }

    #mobile-menu {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(180deg,#0f3460,#1a2a4e);
        backdrop-filter: blur(5px);
        z-index: 1001;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transform: translateY(-100%);
        opacity: 0;
        pointer-events: none;
        transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 0.5s;
    }
    #mobile-menu.is-open {
        transform: translateY(0);
        opacity: 1;
        pointer-events: auto;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
    }
    #mobile-menu a {
        font-size: 2em;
        color: #e0e7ff;
        text-decoration: none;
        font-weight: 600;
        padding: 15px 0;
        margin: 10px 0;
        width: 80%;
        text-align: center;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s ease, transform 0.4s ease;
    }
    #mobile-menu a:last-child { border-bottom: none; }
    #mobile-menu.is-open a {
        opacity: 1;
        transform: translateY(0);
    }
    /* Staggered animation delays for mobile menu links */
    #mobile-menu.is-open a:nth-child(1) { transition-delay: 0.20s; }
    #mobile-menu.is-open a:nth-child(2) { transition-delay: 0.25s; }
    #mobile-menu.is-open a:nth-child(3) { transition-delay: 0.30s; }
    #mobile-menu.is-open a:nth-child(4) { transition-delay: 0.35s; }
    #mobile-menu.is-open a:nth-child(5) { transition-delay: 0.40s; }
    #mobile-menu.is-open a:nth-child(6) { transition-delay: 0.45s; }
    #mobile-menu.is-open a:nth-child(7) { transition-delay: 0.50s; }
    #mobile-menu.is-open a:nth-child(8) { transition-delay: 0.55s; }


    /* Admin specific styles */
    #admin-section {
      display: none; /* 初期状態では非表示 */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 70vh; /* 管理画面の最小高さを設定 */
      padding: 40px;
      background: rgba(10, 20, 40, 0.95); /* 管理画面の背景色を濃く */
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(167, 243, 208, 0.2);
      max-width: 900px; /* 最大幅を設定 */
      margin: 40px auto; /* 中央寄せ */
    }
    /* === 管理者ページのタイトルから縦線を削除 === */
    #admin-section h2 {
      font-size: 2.5em;
      margin-bottom: 25px;
      color: #a7f3d0;
      text-align: center;
      border-left: none; /* 縦線を削除 */
      padding-left: 0; /* パディングを削除 */
      border-right: none; /* 右側の縦線も削除 */
      padding-right: 0; /* 右側のパディングも削除 */
      text-shadow: 0 0 5px rgba(167, 243, 208, 0.5);
    }
    #admin-password-container {
      margin-top: 20px;
      text-align: center;
      width: 100%;
      max-width: 400px;
    }
    /* === パスワード表示機能のスタイル === */
    .password-wrapper {
        position: relative;
        display: flex;
        align-items: center;
    }
    .password-wrapper input {
        padding-right: 45px; /* アイコン分のスペースを確保 */
    }
    #password-toggle-icon {
        position: absolute;
        right: 15px;
        cursor: pointer;
        color: #bfdbfe;
        transition: color 0.3s;
    }
    #password-toggle-icon:hover {
        color: #a7f3d0;
    }
    #admin-content {
      display: none;
      width: 100%;
      flex-direction: column;
      align-items: center;
      margin-top: 30px;
    }
    .admin-feature-block {
      background: rgba(26, 42, 78, 0.8);
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 30px;
      width: 100%;
      box-shadow: 0 6px 18px rgba(0,0,0,0.4);
      border: 1px solid rgba(167, 243, 208, 0.1);
    }
    .admin-feature-block h3 {
        font-size: 1.5em;
        margin-bottom: 5px;
    }
    .admin-feature-block p.description {
        font-size: 0.9em;
        color: #bfdbfe;
        margin-bottom: 15px;
    }
    .admin-feature-block label {
      font-weight: 600;
      margin-bottom: 10px;
    }
    #admin-textarea {
      width: 100%;
      min-height: 400px;
      background: #0d172a;
      border: 1px solid #3b5998;
      border-radius: 10px;
      padding: 20px;
      color: #e0e7ff;
      font-size: 1.1em;
      resize: vertical; /* 縦方向のみリサイズ可能 */
      margin-bottom: 0; /* ボタンとの間隔は親要素で調整 */
      outline: 2px solid transparent;
      outline-offset: 2px;
    }
    #admin-textarea:focus {
      border-color: #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.3);
    }
    #admin-message {
      color: #ef4444; /* 赤色のエラーメッセージ */
      margin-top: 10px;
      font-weight: 500;
      text-align: center;
    }
    #discussion-points-list li, #usage-ideas-list-admin li, #examples-ideas-list-admin li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background-color: rgba(43, 56, 91, 0.7); /* グレー系の背景 */
      border-radius: 8px;
      margin-bottom: 8px;
      border: 1px solid rgba(167, 243, 208, 0.1);
    }
    #discussion-points-list li span, #usage-ideas-list-admin li span, #examples-ideas-list-admin li span {
      flex-grow: 1;
      color: #e0e7ff;
    }
    #discussion-points-list li button, #usage-ideas-list-admin li button, #examples-ideas-list-admin li button {
      background: none;
      border: none;
      color: #ef4444;
      font-size: 1.2em;
      cursor: pointer;
      margin-left: 10px;
      transition: color 0.3s, background-color 0.3s;
      padding: 5px;
      border-radius: 5px;
      outline: 2px solid transparent;
      outline-offset: 2px;
    }
    #discussion-points-list li button:hover, #usage-ideas-list-admin li button:hover, #examples-ideas-list-admin li button:hover {
      color: #dc2626;
      background-color: rgba(239, 68, 68, 0.1);
    }
    #discussion-points-list li button:focus-visible, #usage-ideas-list-admin li button:focus-visible, #examples-ideas-list-admin li button:focus-visible {
      outline: 2px solid #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.5);
    }
    /* New styles for advanced admin features */
    .advanced-admin-feature {
        display: none; /* Default hidden */
    }
    .advanced-admin .advanced-admin-feature {
        display: block; /* Shown when in advanced admin mode */
    }
    #user-list li, #pending-content-list li {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px;
        background-color: rgba(43, 56, 91, 0.7);
        border-radius: 8px;
        margin-bottom: 8px;
        border: 1px solid rgba(167, 243, 208, 0.1);
    }
    #user-list li span, #pending-content-list li span {
        flex-grow: 1;
        color: #e0e7ff;
    }
    #user-list li button, #pending-content-list li button {
        background: none;
        border: none;
        color: #ef4444;
        font-size: 1.2em;
        cursor: pointer;
        margin-left: 10px;
        transition: color 0.3s;
        padding: 5px;
        border-radius: 5px;
        outline: 2px solid transparent;
        outline-offset: 2px;
    }
    #user-list li button:hover, #pending-content-list li button:hover {
        color: #dc2626;
        background-color: rgba(239, 68, 68, 0.1);
    }
    #site-title-input, #welcome-message-input, #user-name-input, #content-title-input {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 20px;
      border: 1px solid #3b5998;
      border-radius: 10px;
      background: #111a2d;
      color: #e0e7ff;
      font-size: 1.05em;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      outline: 2px solid transparent;
      outline-offset: 2px;
    }
    #site-title-input:focus, #welcome-message-input:focus, #user-name-input:focus, #content-title-input:focus {
      outline: none;
      border-color: #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.3);
    }
    .editable-content-textarea {
        width: 100%;
        min-height: 150px;
        padding: 12px 15px;
        margin-bottom: 15px;
        border: 1px solid #3b5998;
        border-radius: 10px;
        background: #111a2d;
        color: #e0e7ff;
        font-size: 1.05em;
        resize: vertical;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        outline: 2px solid transparent;
        outline-offset: 2px;
    }
    .editable-content-textarea:focus {
        outline: none;
        border-color: #a7f3d0;
        box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.3);
    }

    /* Custom Modal Styles */
    .modal-overlay {
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      visibility: hidden; /* Use visibility for transition */
      opacity: 0;
      transition: visibility 0.3s, opacity 0.3s;
    }
    .modal-overlay.is-visible {
      visibility: visible;
      opacity: 1;
    }
    .modal-content {
      background-color: #1a2a4e;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      max-width: 500px;
      width: 90%;
      text-align: center;
      color: #e0e7ff;
      transform: translateY(-20px); /* Initial position for animation */
      transition: transform 0.3s ease-out;
    }
    .modal-overlay.is-visible .modal-content {
      transform: translateY(0); /* Final position */
    }
    .modal-content p {
      font-size: 1.1em;
      margin-bottom: 25px;
      line-height: 1.5;
    }
    .modal-btn {
      background-color: #a7f3d0;
      color: #0f3460;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
      outline: none;
      margin: 0 5px; /* ボタン間のスペース */
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .modal-btn:hover {
      background-color: #7bdcb5;
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .modal-btn:focus-visible {
      outline: 2px solid #a7f3d0;
      box-shadow: 0 0 0 3px rgba(167, 243, 208, 0.5);
    }
    .modal-btn-cancel {
      background-color: #ef4444;
      color: white;
    }
    .modal-btn-cancel:hover {
      background-color: #dc2626;
    }
    .modal-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
    }


    /* === Keyframe animations === */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes pulse {
        0% { transform: scale(1); opacity: 0.1; }
        50% { transform: scale(1.2); opacity: 0.15; }
        100% { transform: scale(1); opacity: 0.1; }
    }
    @keyframes slideInTop {
      0% { opacity: 0; transform: translateY(-50px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideInBottom {
      0% { opacity: 0; transform: translateY(50px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes fill-border {
        from { height: 0%; }
        to { height: 100%; }
    }
    @keyframes gentleFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
    }

    /* === Scroll Animation Styles === */
    .animated-item {
        opacity: 0;
        transform: translateY(40px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .animated-item.is-visible {
        opacity: 1;
        transform: translateY(0);
    }
    .float-on-visible.is-visible {
        animation: gentleFloat 6s ease-in-out infinite 1s;
    }
    /* Staggered animation delays */
    .animated-item.delay-1 { transition-delay: 0.1s; }
    .animated-item.delay-2 { transition-delay: 0.2s; }
    .animated-item.delay-3 { transition-delay: 0.3s; }
    .animated-item.delay-4 { transition-delay: 0.4s; }


    /* Responsive adjustments */
    @media (min-width: 769px) {
        #desktop-nav {
            display: flex;
        }
    }

    @media (max-width: 768px) {
      header {
        padding: 60px 15px;
        border-bottom-left-radius: 30px;
        border-bottom-right-radius: 30px;
      }
      header h1 {
        font-size: 2.8em;
      }
      header p {
        font-size: 1.1em;
      }
      nav {
        justify-content: flex-end; /* ハンバーガーボタンを右に配置 */
      }
      #hamburger-btn {
          display: block;
      }
      main {
        padding: 20px 15px;
        margin: 20px auto;
        border-radius: 15px;
      }
      section {
        margin-bottom: 50px;
        padding: 15px;
        border-radius: 10px;
      }
      h2 {
        font-size: 5em; /* スマホではさらに大きく */
        border-left: 8px solid #a7f3d0; /* 左側に縦線を追加 */
        padding-left: 15px; /* 左側にパディングを追加 */
        border-right: none; /* 右側の縦線は削除 */
        padding-right: 0; /* 右側のパディングも削除 */
        margin-bottom: 35px; /* 余白を増やす */
      }
      p {
        font-size: 1.05em; /* スマホでは少し小さく */
      }
      .team {
        grid-template-columns: 1fr; /* 1列表示 */
        gap: 20px;
      }
      .member {
        padding: 20px;
        border-radius: 12px;
      }
      .member h4 {
        font-size: 1.4em;
      }
      form {
        padding: 25px;
        border-radius: 15px;
      }
      input[type="text"],
      input[type="email"],
      input[type="password"],
      textarea {
        padding: 10px 12px;
        margin-bottom: 15px;
        border-radius: 8px;
        font-size: 0.95em;
      }
      input[type="submit"],
      .btn-primary,
      .btn-secondary {
        padding: 10px 25px;
        border-radius: 8px;
        font-size: 1em;
      }
      footer {
        margin-top: 40px;
        padding: 20px;
        border-top-left-radius: 30px;
        border-top-right-radius: 30px;
      }
      #scrollToTopBtn {
        width: 40px;
        height: 40px;
        font-size: 1.5em;
        line-height: 40px;
        bottom: 20px;
        right: 20px;
      }
      #admin-section {
        padding: 20px;
      }
      #admin-section h2 {
        font-size: 2em;
      }
      #admin-textarea {
        min-height: 300px;
        font-size: 1em;
      }
      .modal-content {
        padding: 20px;
      }
      .modal-btn {
        padding: 8px 15px;
        font-size: 0.9em;
      }
    }
    @media (max-width: 480px) {
      header h1 {
        font-size: 2.2em;
      }
      header p {
        font-size: 1em;
      }
      h2 {
        font-size: 4.5em; /* さらに大きく */
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>長野の廃校殲滅計画！</h1>
    <p>地域資源を未来へつなぐプロジェクト</p>
  </header>
  <nav>
    <div id="desktop-nav">
        <a href="#mission" aria-label="私たちの想い">私たちの想い</a>
        <a href="#usage" aria-label="廃校の活用案">廃校の活用案</a>
        <a href="#challenges" aria-label="廃校の現状と課題">廃校の現状と課題</a>
        <a href="#examples" aria-label="活用事例">活用事例</a>
        <a href="#nagano-details" aria-label="長野の魅力と地域性">長野の魅力</a>
        <a href="#team" aria-label="チーム紹介">チーム紹介</a>
        <a href="#contact" aria-label="お問い合わせ">お問い合わせ</a>
        <a href="#" id="adminLink" aria-label="管理者ページへ">管理者</a>
    </div>
  </nav>

  <button id="hamburger-btn" aria-label="メニューを開閉する" aria-expanded="false">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>

  <div id="mobile-menu">
    <a href="#mission" aria-label="私たちの想い">私たちの想い</a>
    <a href="#usage" aria-label="廃校の活用案">廃校の活用案</a>
    <a href="#challenges" aria-label="廃校の現状と課題">廃校の現状と課題</a>
    <a href="#examples" aria-label="活用事例">活用事例</a>
    <a href="#nagano-details" aria-label="長野の魅力と地域性">長野の魅力</a>
    <a href="#team" aria-label="チーム紹介">チーム紹介</a>
    <a href="#contact" aria-label="お問い合わせ">お問い合わせ</a>
    <a href="#" id="adminLinkMobile" aria-label="管理者ページへ">管理者</a>
  </div>

  <main id="main-content">
    <section id="mission">
      <h2 class="animated-item">私たちの想い</h2>
      <div id="mission-content-container" class="animated-item delay-1">
        <!-- Content will be dynamically loaded here -->
      </div>
    </section>

    <section id="challenges">
      <h2 class="animated-item">廃校の現状と課題</h2>
      <div id="challenges-content-container" class="animated-item float-on-visible delay-1">
        <!-- Content will be dynamically loaded here -->
      </div>
    </section>

    <section id="usage">
      <h2 class="animated-item">廃校の多様な活用案</h2>
      <div id="usage-intro-container" class="animated-item float-on-visible delay-1">
         <!-- Intro content will be dynamically loaded here -->
      </div>
      <div id="usage-ideas-container">
        <!-- Dynamic idea blocks will be inserted here -->
      </div>
    </section>

    <section id="examples">
      <h2 class="animated-item">全国・長野県内の活用事例</h2>
      <div id="examples-intro-container" class="animated-item float-on-visible delay-1">
         <!-- Intro content will be dynamically loaded here -->
      </div>
      <div id="examples-ideas-container">
        <!-- Dynamic idea blocks will be inserted here -->
      </div>
    </section>

    <section id="nagano-details">
      <h2 class="animated-item">長野の魅力と地域性</h2>
      <div id="nagano-details-content-container" class="animated-item delay-1">
        <!-- Content will be dynamically loaded here -->
      </div>
    </section>

    <section id="team">
      <h2 class="animated-item">プロジェクトメンバー</h2>
      <div id="team-content-container" class="animated-item float-on-visible delay-1">
         <!-- Intro content will be dynamically loaded here -->
      </div>
      <div class="team" id="team-members-container">
        <!-- Dynamic team members will be inserted here -->
      </div>
    </section>
    <section id="contact">
      <h2 class="animated-item">お問い合わせ</h2>
      <p class="mb-6 animated-item delay-1">プロジェクトに関するご質問やご意見は、以下のフォームからお寄せください。</p>
      <form id="contact-form" class="animated-item delay-2">
        <label for="name" class="block mb-2 text-blue-200">お名前：</label>
        <input type="text" id="name" name="name" required aria-label="お名前を入力してください">

        <label for="email" class="block mb-2 text-blue-200">メールアドレス：</label>
        <input type="email" id="email" name="email" required aria-label="メールアドレスを入力してください">

        <label for="message" class="block mb-2 text-blue-200">メッセージ：</label>
        <textarea id="message" name="message" rows="5" cols="40" aria-label="メッセージを入力してください"></textarea>

        <input type="submit" value="送信" id="contact-submit-btn">
      </form>
      <div id="form-message" class="mt-4 text-center" style="display: none;"></div>
    </section>
  </main>

  <!-- Admin Section -->
  <div id="admin-section">
    <h2>管理者ページ</h2>
    <div id="admin-password-container">
      <p class="mb-4">管理者パスワードを入力してください：</p>
      <div class="password-wrapper">
        <input type="password" id="admin-password" placeholder="パスワード" aria-label="管理者パスワードを入力">
        <span id="password-toggle-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        </span>
      </div>
      <button id="admin-login-btn" class="btn-primary mt-4" aria-label="ログイン">ログイン</button>
      <p id="admin-message" class="mt-2 text-red-400" style="display: none;">パスワードが間違っています。</p>
    </div>
    <div id="admin-content">
      <div class="admin-feature-block">
        <h3>議論の記録</h3>
        <p class="description">プロジェクトに関する議論のテーマや詳細なメモを記録・管理します。</p>
        <label for="discussion-topic" class="block mb-2 text-blue-200 text-lg">議論テーマ：</label>
        <input type="text" id="discussion-topic" class="w-full p-3 rounded-md bg-gray-800 text-white border border-gray-600 focus:border-green-400 focus:ring focus:ring-green-400 focus:ring-opacity-50" placeholder="議論のテーマを入力" aria-label="議論のテーマ">
        <label for="admin-textarea" class="block mb-2 mt-4 text-blue-200 text-lg">議論メモ / 詳細：</label>
        <textarea id="admin-textarea" class="w-full min-h-[400px] p-3 rounded-md bg-gray-800 text-white border border-gray-600 focus:border-green-400 focus:ring focus:ring-green-400 focus:ring-opacity-50 resize-y" placeholder="ここに議論の詳細やメモを記述できます。" aria-label="議論の詳細やメモを記述するテキストエリア"></textarea>
        <div class="flex justify-end gap-4 mt-4">
          <button id="save-notes-btn" class="btn-secondary" aria-label="メモを保存">メモを保存</button>
          <button id="clear-notes-btn" class="btn-secondary" aria-label="メモをクリア">メモをクリア</button>
        </div>
      </div>

      <div class="admin-feature-block">
        <h3>議論ポイントの管理</h3>
        <p class="description">議論で出た重要なポイントをリストとして追加・管理します。</p>
        <div class="flex gap-2 mb-3">
          <input type="text" id="discussion-point-input" class="flex-grow p-3 rounded-md bg-gray-800 text-white border border-gray-600 focus:border-green-400 focus:ring focus:ring-green-400 focus:ring-opacity-50" placeholder="新しい議論ポイントを追加" aria-label="新しい議論ポイントを追加">
          <button id="add-point-btn" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition duration-200" aria-label="ポイントを追加">追加</button>
        </div>
        <ul id="discussion-points-list" class="list-none ml-0 space-y-2">
          <!-- Discussion points will be dynamically added here -->
        </ul>
        <div class="flex justify-end mt-4">
          <button id="clear-points-btn" class="btn-secondary" aria-label="ポイントリストをクリア">ポイントをクリア</button>
        </div>
      </div>

      <div class="admin-feature-block">
        <h3>サイトコンテンツ管理</h3>
        <p class="description">ウェブサイトの各セクションのテキストやアイデアを直接編集します。</p>

        <div class="mt-4">
          <h4 class="text-lg text-blue-200 mb-2">主要セクションテキストの編集</h4>
          <label for="mission-text-editor" class="block mb-2 text-blue-200">私たちの想い (冒頭):</label>
          <textarea id="mission-text-editor" class="editable-content-textarea"></textarea>
          <label for="challenges-text-editor" class="block mb-2 text-blue-200">廃校の現状と課題 (冒頭):</label>
          <textarea id="challenges-text-editor" class="editable-content-textarea"></textarea>
          <label for="usage-intro-editor" class="block mb-2 text-blue-200">廃校の多様な活用案 (冒頭):</label>
          <textarea id="usage-intro-editor" class="editable-content-textarea"></textarea>
          <label for="examples-intro-editor" class="block mb-2 text-blue-200">活用事例 (冒頭):</label>
          <textarea id="examples-intro-editor" class="editable-content-textarea"></textarea>
          <label for="nagano-details-editor" class="block mb-2 text-blue-200">長野の魅力と地域性:</label>
          <textarea id="nagano-details-editor" class="editable-content-textarea"></textarea>
          <button id="save-main-content-btn" class="btn-secondary mt-2">主要コンテンツを保存</button>
        </div>

        <div class="mt-8">
          <h4 class="text-lg text-blue-200 mb-2">活用案の管理</h4>
          <div class="flex gap-2 mb-3">
            <input type="text" id="new-usage-idea-title" class="flex-grow p-3 rounded-md bg-gray-800 text-white border border-gray-600 focus:border-green-400 focus:ring focus:ring-green-400 focus:ring-opacity-50" placeholder="新しい活用案のタイトル" aria-label="新しい活用案のタイトル">
          </div>
          <textarea id="new-usage-idea-description" class="editable-content-textarea" placeholder="新しい活用案の説明" aria-label="新しい活用案の説明"></textarea>
          <button id="add-usage-idea-btn" class="btn-secondary mt-2">活用案を追加</button>
          <div class="mt-4">
            <h5 class="text-md text-blue-200 mb-2">既存の活用案:</h5>
            <ul id="usage-ideas-list-admin" class="list-none ml-0 space-y-2">
              <!-- Dynamically loaded usage ideas for admin to manage -->
            </ul>
          </div>
        </div>

        <div class="mt-8">
          <h4 class="text-lg text-blue-200 mb-2">活用事例の管理</h4>
          <div class="flex gap-2 mb-3">
            <input type="text" id="new-example-idea-title" class="flex-grow p-3 rounded-md bg-gray-800 text-white border border-gray-600 focus:border-green-400 focus:ring focus:ring-green-400 focus:ring-opacity-50" placeholder="新しい活用事例のタイトル" aria-label="新しい活用事例のタイトル">
          </div>
          <textarea id="new-example-idea-description" class="editable-content-textarea" placeholder="新しい活用事例の説明" aria-label="新しい活用事例の説明"></textarea>
          <button id="add-example-idea-btn" class="btn-secondary mt-2">活用事例を追加</button>
          <div class="mt-4">
            <h5 class="text-md text-blue-200 mb-2">既存の活用事例:</h5>
            <ul id="examples-ideas-list-admin" class="list-none ml-0 space-y-2">
              <!-- Dynamically loaded example ideas for admin to manage -->
            </ul>
          </div>
        </div>
      </div>

      <div class="admin-feature-block mt-8 advanced-admin-feature">
        <h3>高度な管理機能</h3>
        <p class="description">サイトの基本設定やユーザー管理など、より高度な操作を行います。</p>
        <div class="mt-4">
          <h4 class="text-lg text-blue-200 mb-2">サイト設定</h4>
          <label for="site-title-input" class="block mb-2 text-blue-200">サイトタイトル:</label>
          <input type="text" id="site-title-input" placeholder="サイトの新しいタイトル" aria-label="サイトタイトルを入力">
          <label for="welcome-message-input" class="block mb-2 text-blue-200">ウェルカムメッセージ:</label>
          <textarea id="welcome-message-input" rows="3" placeholder="新しいウェルカムメッセージ" aria-label="ウェルカムメッセージを入力"></textarea>
          <button id="update-site-settings-btn" class="btn-secondary mt-2">設定を更新</button>
        </div>

        <div class="mt-4">
          <h4 class="text-lg text-blue-200 mb-2">ユーザー管理</h4>
          <div class="flex gap-2 mb-3">
            <input type="text" id="user-name-input" class="flex-grow p-3 rounded-md bg-gray-800 text-white border border-gray-600 focus:border-green-400 focus:ring focus:ring-green-400 focus:ring-opacity-50" placeholder="新しいユーザー名" aria-label="新しいユーザー名を入力">
            <button id="add-user-btn" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition duration-200" aria-label="ユーザーを追加">追加</button>
          </div>
          <ul id="user-list" class="list-none ml-0 space-y-2">
            <!-- Dummy users will be dynamically added here -->
          </ul>
        </div>

        <div class="mt-4">
          <h4 class="text-lg text-blue-200 mb-2">未承認コンテンツ</h4>
          <div class="flex gap-2 mb-3">
            <input type="text" id="content-title-input" class="flex-grow p-3 rounded-md bg-gray-800 text-white border border-gray-600 focus:border-green-400 focus:ring focus:ring-green-400 focus:ring-opacity-50" placeholder="新しいコンテンツタイトル" aria-label="新しいコンテンツタイトルを入力">
            <button id="add-pending-content-btn" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition duration-200" aria-label="コンテンツを追加">追加</button>
          </div>
          <ul id="pending-content-list" class="list-none ml-0 space-y-2">
            <!-- Dummy pending content will be dynamically added here -->
          </ul>
        </div>

        <div>
          <h4 class="text-lg text-blue-200 mb-2">二要素認証設定</h4>
          <p class="mb-2">現在の状態: <span id="mfa-status">無効</span></p>
          <button id="enable-mfa-btn" class="btn-secondary">二要素認証を有効にする</button>
        </div>
        <div class="mt-4">
          <h4 class="text-lg text-blue-200 mb-2">セッション管理</h4>
          <p class="mb-2">現在のアクティブセッション: <span id="active-sessions">3</span></p>
          <button id="terminate-session-btn" class="btn-secondary">全セッションを終了する</button>
        </div>
        <div class="mt-4">
          <h4 class="text-lg text-blue-200 mb-2">システムログ</h4>
          <p class="mb-2">最新のログ: <code id="recent-log">ログがありません</code></p>
          <button id="view-log-btn" class="btn-secondary">ログを表示</button>
        </div>
        <div class="mt-4">
          <h4 class="text-lg text-blue-200 mb-2">データ管理</h4>
          <div class="flex gap-2 mb-3">
            <button id="export-data-btn" class="btn-secondary">データをエクスポート</button>
            <label for="import-data-input" class="btn-secondary cursor-pointer">データをインポート</label>
            <input type="file" id="import-data-input" accept="application/json" style="display:none;">
          </div>
        </div>
      </div>

      <button id="admin-back-btn" class="btn-primary mt-12" aria-label="メインページに戻る">メインページに戻る</button>
    </div>
  </div>

  <button id="scrollToTopBtn" title="トップへ戻る" aria-label="ページトップへスクロール">↑</button>

  <!-- Custom Modal for Alerts -->
  <div id="custom-alert-modal" class="modal-overlay">
    <div class="modal-content">
      <p id="custom-alert-message"></p>
      <button id="custom-alert-ok-btn" class="modal-btn">OK</button>
    </div>
  </div>

  <!-- Custom Modal for Confirms -->
  <div id="custom-confirm-modal" class="modal-overlay">
    <div class="modal-content">
      <p id="custom-confirm-message"></p>
      <div class="modal-actions">
        <button id="custom-confirm-ok-btn" class="modal-btn">はい</button>
        <button id="custom-confirm-cancel-btn" class="modal-btn modal-btn-cancel">いいえ</button>
      </div>
    </div>
  </div>

  <script>
    // 主要コンテンツと管理者コンテンツのDOM要素を取得
    const mainContent = document.getElementById("main-content");
    const adminSection = document.getElementById("admin-section");
    const adminLink = document.getElementById("adminLink");
    const adminPasswordInput = document.getElementById("admin-password");
    const adminLoginBtn = document.getElementById("admin-login-btn");
    const adminPasswordContainer = document.getElementById("admin-password-container");
    const adminContent = document.getElementById("admin-content");
    const adminBackBtn = document.getElementById("admin-back-btn");
    const adminMessage = document.getElementById("admin-message");

    // 管理者ページ機能関連のDOM要素
    const discussionTopicInput = document.getElementById("discussion-topic");
    const adminTextarea = document.getElementById("admin-textarea");
    const saveNotesBtn = document.getElementById("save-notes-btn");
    const clearNotesBtn = document.getElementById("clear-notes-btn");
    const discussionPointInput = document.getElementById("discussion-point-input");
    const addPointBtn = document.getElementById("add-point-btn");
    const discussionPointsList = document.getElementById("discussion-points-list");
    const clearPointsBtn = document.getElementById("clear-points-btn");

    // 高度な管理機能のDOM要素
    const mfaStatusSpan = document.getElementById("mfa-status");
    const enableMfaBtn = document.getElementById("enable-mfa-btn");
    const activeSessionsSpan = document.getElementById("active-sessions");
    const terminateSessionBtn = document.getElementById("terminate-session-btn");
    const recentLogCode = document.getElementById("recent-log");
    const viewLogBtn = document.getElementById("view-log-btn");
    const exportDataBtn = document.getElementById("export-data-btn");
    const importDataInput = document.getElementById("import-data-input");

    // 新しい高度な管理機能のDOM要素 (元からあったもの)
    const siteTitleInput = document.getElementById("site-title-input");
    const welcomeMessageInput = document.getElementById("welcome-message-input");
    const updateSiteSettingsBtn = document.getElementById("update-site-settings-btn");
    const userNameInput = document.getElementById("user-name-input");
    const addUserBtn = document.getElementById("add-user-btn");
    const userList = document.getElementById("user-list");
    const contentTitleInput = document.getElementById("content-title-input");
    const addPendingContentBtn = document.getElementById("add-pending-content-btn");
    const pendingContentList = document.getElementById("pending-content-list");
    const advancedAdminFeatures = document.querySelectorAll('.advanced-admin-feature');

    // お問い合わせフォームの送信ボタン
    const contactSubmitBtn = document.getElementById('contact-submit-btn');

    // 新しく追加するコンテンツ管理用DOM要素
    const missionContentContainer = document.getElementById('mission-content-container');
    const challengesContentContainer = document.getElementById('challenges-content-container');
    const usageIntroContainer = document.getElementById('usage-intro-container');
    const usageIdeasContainer = document.getElementById('usage-ideas-container');
    const examplesIntroContainer = document.getElementById('examples-intro-container');
    const examplesIdeasContainer = document.getElementById('examples-ideas-container');
    const naganoDetailsContentContainer = document.getElementById('nagano-details-content-container'); // 追加
    const teamContentContainer = document.getElementById('team-content-container');
    const teamMembersContainer = document.getElementById('team-members-container');


    const missionTextEditor = document.getElementById('mission-text-editor');
    const challengesTextEditor = document.getElementById('challenges-text-editor');
    const usageIntroEditor = document.getElementById('usage-intro-editor');
    const examplesIntroEditor = document.getElementById('examples-intro-editor');
    const naganoDetailsEditor = document.getElementById('nagano-details-editor'); // 追加
    const saveMainContentBtn = document.getElementById('save-main-content-btn');

    const newUsageIdeaTitleInput = document.getElementById('new-usage-idea-title');
    const newUsageIdeaDescriptionInput = document.getElementById('new-usage-idea-description');
    const addUsageIdeaBtn = document.getElementById('add-usage-idea-btn');
    const usageIdeasListAdmin = document.getElementById('usage-ideas-list-admin');

    const newExampleIdeaTitleInput = document.getElementById('new-example-idea-title');
    const newExampleIdeaDescriptionInput = document.getElementById('new-example-idea-description');
    const addExampleIdeaBtn = document.getElementById('add-example-idea-btn');
    const examplesIdeasListAdmin = document.getElementById('examples-ideas-list-admin');

    // --- モバイルメニュー関連のDOM要素 ---
    const hamburgerBtn = document.getElementById('hamburger-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuLinks = mobileMenu.querySelectorAll('a');
    const adminLinkMobile = document.getElementById('adminLinkMobile');

    // --- パスワード表示機能関連のDOM要素 ---
    const passwordToggleIcon = document.getElementById('password-toggle-icon');

   
    // === パスワードの難読化 ===
    const P_A = 'c2hpYmF1cmE='; // "shibaura" をBase64エンコード
    const P_ADV = 'bmFnYW5vaGFpa291Z3JvdXA='; // "naganohaikougroup" をBase64エンコード

    let isAdvancedAdmin = false;

    // --- カスタムモーダル関連 ---
    const customAlertDialog = document.getElementById('custom-alert-modal');
    const customAlertMessage = document.getElementById('custom-alert-message');
    const customAlertOkBtn = document.getElementById('custom-alert-ok-btn');

    const customConfirmDialog = document.getElementById('custom-confirm-modal');
    const customConfirmMessage = document.getElementById('custom-confirm-message');
    const customConfirmOkBtn = document.getElementById('custom-confirm-ok-btn');
    const customConfirmCancelBtn = document.getElementById('custom-confirm-cancel-btn');

    let confirmCallback = null; // confirmのコールバック関数を格納

    /**
     * カスタムアラートダイアログを表示
     * @param {string} message - 表示するメッセージ
     */
    function showAlert(message) {
      customAlertMessage.textContent = message;
      customAlertDialog.classList.add('is-visible');
      customAlertOkBtn.focus(); // OKボタンにフォーカス
    }

    /**
     * カスタム確認ダイアログを表示
     * @param {string} message - 表示するメッセージ
     * @param {function(boolean): void} callback - 確認結果を返すコールバック関数
     */
    function showConfirm(message, callback) {
      customConfirmMessage.innerHTML = message; // innerHTMLを使用してHTMLタグを許容
      confirmCallback = callback;
      customConfirmDialog.classList.add('is-visible');
      customConfirmOkBtn.focus(); // OKボタンにフォーカス
    }

    customAlertOkBtn.addEventListener('click', () => {
      customAlertDialog.classList.remove('is-visible');
    });

    customConfirmOkBtn.addEventListener('click', () => {
      customConfirmDialog.classList.remove('is-visible');
      if (confirmCallback) {
        confirmCallback(true); // はいがクリックされた
        confirmCallback = null;
      }
    });

    customConfirmCancelBtn.addEventListener('click', () => {
      customConfirmDialog.classList.remove('is-visible');
      if (confirmCallback) {
        confirmCallback(false); // いいえがクリックされた
        confirmCallback = null;
      }
    });

    // window.alert と window.confirm をカスタムモーダルに置き換え
    window.alert = showAlert;
    window.confirm = showConfirm;

    // --- ローディングアニメーション関数 ---
    /**
     * ボタンにローディング状態を適用する
     * @param {HTMLElement} buttonElement - ローディング状態にするボタン要素
     */
    function showLoading(buttonElement) {
        buttonElement.classList.add('btn-loading');
        buttonElement.disabled = true; // ボタンを無効化
    }

    /**
     * ボタンのローディング状態を解除する
     * @param {HTMLElement} buttonElement - ローディング状態を解除するボタン要素
     */
    function hideLoading(buttonElement) {
        buttonElement.classList.remove('btn-loading');
        buttonElement.disabled = false; // ボタンを有効化
    }

    // --- サイトコンテンツの初期データと管理 ---
    const defaultContent = {
      mission: `少子化と過疎化が進行する長野県において、廃校は単なる空き家ではなく、地域の記憶と未来の可能性を秘めた大切な資源です。私たちは、これらの廃校を新たな価値を持つ場所として再生し、地域活性化に貢献することを目指しています。
<p class="mt-4">長野県の人口は2001年のピークから減少の一途をたどり、2024年には200万人を下回ると予測されています。この人口減少と少子化の影響で、県内の廃校数は年々増加しており、地域社会に新たな課題を投げかけています。しかし、廃校は単なる負の遺産ではありません。かつて子どもたちの声が響き渡った学び舎は、地域文化の中心であり、新たな可能性を秘めた場所なのです。</p>
<p class="mt-4">長野県は、雄大な北アルプスを始めとする豊かな自然、清らかな水、そして歴史と文化が息づく魅力的な地域です。この地の廃校を再利用することは、自然との共生、伝統の継承、そして新しいライフスタイルの提案に繋がると信じています。私たちは、長野の魅力を最大限に引き出し、持続可能な地域社会を築くことを目指します。</p>`,
      challenges: `長野県における廃校は、以下のようないくつかの深刻な課題を抱えています。
<ul class="mt-4">
<li><strong>維持管理コストの増大</strong>: 電気、水道、施設の修繕、固定資産税など、使われていない建物にも維持費用がかかり、自治体や地域の財政を圧迫しています。老朽化が進むにつれて、このコストはさらに増大する傾向にあります。</li>
<li><strong>老朽化と安全性の問題</strong>: 長期間使用されないことで建物の老朽化が急速に進み、倒壊の危険性や、不法侵入による事故、火災、または犯罪のリスクが増加しています。地域住民の安全確保が喫緊の課題です。</li>
<li><strong>景観の悪化と地域イメージの低下</strong>: 雑草が生い茂り、窓ガラスが割れた荒廃した廃校は、地域の景観を著しく損ねます。これは、外部からの訪問者や移住希望者に対してネガティブな印象を与え、地域全体の魅力低下につながりかねません。</li>
<li><strong>地域コミュニティの中核機能の喪失</strong>: 学校は、かつて運動会や文化祭、地域のお祭りなど、様々なイベントの会場であり、地域住民の交流の中心でした。廃校により、そのコミュニティ形成の場が失われ、地域社会の活力が低下する傾向にあります。特に高齢化が進む地域では、この影響は深刻です。</li>
<li><strong>貴重な地域資源の機会損失</strong>: 広大な敷地やユニークな構造、そして地域の歴史を刻んだ廃校は、本来であれば様々な創造的な活用が期待できる貴重な地域資源です。しかし、適切な活用策が見出せないことで、その潜在的な価値が失われ、地域の発展の機会を逃しています。</li>
</ul>
<p class="mt-6">長野県では、特に山間部や中山間地域でこの問題が顕著です。地域の高齢化が進む一方で、若年層の流出が続き、地域を支える人材が不足しています。これにより、廃校の有効活用に向けた議論や実行が停滞しがちです。しかし、私たちはこの課題を、新たな発想と地域内外の連携で乗り越えられると信じています。</p>`,
      usageIntro: `私たちは、廃校が持つ無限の可能性を信じ、地域に根ざした多様な活用アイデアを提案します。それぞれの案が、地域の特性とニーズに合致するように検討されています。`,
      examplesIntro: `廃校の活用は、地域の課題解決と活性化に繋がる成功事例が多数存在します。これらの事例から学び、長野の廃校に最適な活用策を見出すことができます。`,
      naganoDetails: `長野県は、日本の本州中央部に位置する内陸県で、その広大な面積と多様な地理的特徴が最大の魅力です。標高3,000メートル級の山々が連なる「日本の屋根」として知られる中央アルプス、南アルプス、飛騨山脈（北アルプス）に囲まれ、美しい山岳景観が広がっています。
<p class="mt-4">県内には、諏訪湖、木崎湖、野尻湖など、自然豊かな湖沼が点在し、千曲川、天竜川といった大河の源流も抱えています。これらの豊かな水資源は、農業や地域文化を育んできました。気候は、標高や地域によって大きく異なり、冬は寒く積雪が多いですが、夏は冷涼で過ごしやすい地域が多いのが特徴です。特に、軽井沢や上高地などの高原リゾートは、夏の避暑地として人気を集めています。</p>
<p class="mt-4">文化的には、古くから宿場町として栄えた歴史を持ち、善光寺に代表される寺社仏閣、松本城のような国宝の城郭など、歴史的建造物も豊富です。また、伝統的な蕎麦、信州味噌、地酒などの食文化も根付いており、季節ごとの旬の食材も豊かです。ウィンタースポーツ、登山、温泉、ハイキングなど、四季を通じて多様なアクティビティを楽しむことができ、国内外から多くの観光客が訪れます。地域ごとに異なる「信州らしさ」が感じられる、魅力あふれる県です。</p>`,
      teamContent: ``, // Team members are handled separately
      siteTitle: '長野の廃校殲滅計画！',
      welcomeMessage: '地域資源を未来へつなぐプロジェクト'
    };

    const defaultIdeas = [
      { id: 'u1', type: 'usage', title: '地域交流・活動拠点としての再生', description: '使われなくなった教室や体育館を、多世代が交流できる場として再構築します。地域の集会所、高齢者サロン、子どもたちの遊び場、または地元食材を提供するカフェやパン工房など、誰もが気軽に立ち寄れるオープンな空間を提供します。地域のイベント開催や、住民同士の新しいつながりを生み出すハブとなります。' },
      { id: 'u2', type: 'usage', title: '観光・宿泊施設への転換', description: '廃校のノスタルジックな雰囲気と広々とした空間を最大限に活かし、宿泊体験型施設やワーケーション（仕事と休暇を組み合わせた滞在）向けの施設として整備します。教室を客室に、体育館を共有スペースに改修し、都会からの訪問者や企業研修の誘致により、新たな観光客の流れと地域経済の活性化を生み出します。修学旅行のような体験も提供可能です。' },
      { id: 'u3', type: 'usage', title: '地域資源を学ぶ体験型教育施設', description: '地元の豊かな自然や歴史、伝統文化を学べる体験型ミュージアムやワークショップスペースとして活用します。例えば、地域の工芸品作り、農業体験、星空観察など、子どもから大人までが長野の魅力を深く知り、未来へとつなぐ学びの場を創出します。これにより、地域外からの教育旅行の誘致も期待できます。' },
      { id: 'u4', type: 'usage', title: 'クリエイティブ・アートハブとしての活用', description: '広い空間や独特の雰囲気を活かして、アーティストのアトリエ、ギャラリー、音楽スタジオ、演劇の稽古場など、クリエイティブな活動の拠点とします。地域内外のアーティストが集まることで、新たな文化の発信地となり、若者の移住促進や地域への定着にもつながります。アートイベントやワークショップの開催も可能です。' },
      { id: 'u5', type: 'usage', title: '防災拠点・地域レジリエンス強化施設', description: '災害時には避難所や物資の備蓄拠点として機能させるとともに、平時には防災訓練や地域住民のコミュニティ形成の場として活用します。地域住民が防災意識を高め、有事の際に互いに助け合える強靭なコミュニティを築くための重要なインフラとなります。備蓄倉庫や簡易シャワー施設なども整備可能です。' },
      { id: 'u6', type: 'usage', title: '地域産業振興のための施設', description: '廃校の敷地や建物を活用し、地域の特産品加工施設、地酒の醸造所、クラフトビールのブルワリー、または小規模な工場として転用します。これにより、新たな雇用を創出し、地域経済の活性化に直接貢献します。製品の直売所や体験コーナーを併設することで、観光客の誘致にも繋がります。' },
      { id: 'e1', type: 'examples', title: '道の駅「きらら289」（福島県南会津町）', description: '旧南郷小学校の校舎を改修し、道の駅として生まれ変わりました。地域の特産品販売、レストラン、休憩スペースに加え、旧体育館を「木育施設」として活用し、子どもたちが木材と触れ合いながら遊べる場となっています。地域の交流促進と観光客誘致に成功した好例です。' },
      { id: 'e2', type: 'examples', title: '「ちいさなせかい」（長野県大町市）', description: '旧美麻小学校を利用した宿泊施設。校舎の雰囲気を残しつつ、モダンなデザインと快適性を両立させ、ワーケーションや合宿、イベント利用にも対応しています。併設されたカフェは、地域住民や訪問者の交流の場としても機能し、地域に新たな賑わいをもたらしています。<p class="mt-2">この事例は、長野県が持つ自然の美しさ、静寂な環境、そして美しい星空や豊かな森林が、都市部の喧騒から離れて仕事や休暇を過ごしたい人々に新たな価値を提供できることを示しています。</p>' },
      { id: 'e3', type: 'examples', title: '「星と森のロマントピア」（青森県弘前市）', description: '旧小学校の跡地に建設された天文台を核とする総合レジャー施設。宿泊施設、温泉、キャンプ場なども備え、星空観測をテーマにしたユニークな体験を提供しています。これにより、広範囲からの観光客を誘致し、地域の観光振興に大きく貢献しています。' },
      { id: 'e4', type: 'examples', title: '旧日義小学校「きそむら体験交流館」（長野県木曽町）', description: '木曽町の旧日義小学校は、地域住民と観光客が交流できる体験交流館として活用されています。木工体験や郷土料理作りなど、木曽の文化を体験できるプログラムが提供されており、地域の魅力を発信する拠点となっています。' },
      { id: 'e5', type: 'examples', title: '「スタジオジブリ風の谷のナウシカ」イメージのアトリエ（長野県下諏訪町）', description: '具体的な施設名ではないですが、長野県内には廃校をアートスタジオやアトリエとして活用し、自然豊かな環境で創作活動に集中できるクリエイターが移住・活動する例が増えています。地域の風景と調和したアート活動は、新たな地域ブランドの創出にも繋がっています。' }
    ];

    const defaultTeamMembers = [
      { id: 't1', name: '國井秀哉', role: '資料作成・Webサイト制作統括担当。プロジェクトのビジョンを明確にし、視覚的な魅力を最大限に引き出すための資料作成とWebサイト全体の統括を行いました。' },
      { id: 't2', name: '安藤堪祐', role: '地域住民との対話・議論推進担当。現地での詳細なヒアリングを通じて、地域の方々の生の声やニーズを深く掘り下げ、プロジェクトの方向性を決定する上での重要な議論を主導しました。' },
      { id: 't3', name: '加藤康成', role: 'プレゼンテーション資料作成・デザイン担当。複雑なデータや情報を分かりやすく、かつ美しく可視化するデザインスキルを活かし、プロジェクトの魅力を効果的に伝える資料を作成しました。' },
      { id: 't4', name: '伊沢威霖', role: 'プレゼンテーション資料作成・技術サポート担当。資料作成における技術的な側面（ソフトウェア操作、データ処理など）を幅広くサポートし、発表がスムーズに行われるよう舞台裏で支えました。' }
    ];

    // ローカルストレージにデータがなければ初期値を設定
    function initializeContent() {
      if (!localStorage.getItem('mainContentData')) {
        localStorage.setItem('mainContentData', JSON.stringify(defaultContent));
      }
      if (!localStorage.getItem('ideasData')) {
        localStorage.setItem('ideasData', JSON.stringify(defaultIdeas));
      }
      if (!localStorage.getItem('teamMembersData')) {
        localStorage.setItem('teamMembersData', JSON.stringify(defaultTeamMembers));
      }
    }

    // --- サイトコンテンツの表示 ---
    function loadSiteContent() {
      const storedContent = JSON.parse(localStorage.getItem('mainContentData'));
      const storedIdeas = JSON.parse(localStorage.getItem('ideasData'));
      const storedTeamMembers = JSON.parse(localStorage.getItem('teamMembersData'));

      // Header のタイトルとメッセージを更新
      document.querySelector('header h1').textContent = storedContent.siteTitle;
      document.querySelector('header p').textContent = storedContent.welcomeMessage;
      document.title = storedContent.siteTitle; // ページのタイトルも更新

      // 主要セクションのコンテンツを更新
      missionContentContainer.innerHTML = storedContent.mission;
      challengesContentContainer.innerHTML = storedContent.challenges;
      usageIntroContainer.innerHTML = `<p class="mb-6">${storedContent.usageIntro}</p>`;
      examplesIntroContainer.innerHTML = `<p class="mb-6">${storedContent.examplesIntro}</p>`;
      naganoDetailsContentContainer.innerHTML = storedContent.naganoDetails;

      // 活用案と活用事例を動的にレンダリング
      usageIdeasContainer.innerHTML = '';
      examplesIdeasContainer.innerHTML = '';
      let ideaDelay = 2;
      storedIdeas.forEach(idea => {
        const ideaDiv = document.createElement('div');
        ideaDiv.className = `idea animated-item float-on-visible delay-${ideaDelay % 4 + 1}`; // アニメーションクラスを追加
        ideaDiv.innerHTML = `<h3>${idea.title}</h3><p>${idea.description}</p>`;
        if (idea.type === 'usage') {
          usageIdeasContainer.appendChild(ideaDiv);
        } else if (idea.type === 'examples') {
          examplesIdeasContainer.appendChild(ideaDiv);
        }
        ideaDelay++;
      });

      // チームメンバーを動的にレンダリング
      teamMembersContainer.innerHTML = '';
      let memberDelay = 2;
      storedTeamMembers.forEach(member => {
        const memberDiv = document.createElement('div');
        memberDiv.className = `member animated-item float-on-visible delay-${memberDelay % 2 + 1}`; // アニメーションクラスを追加
        memberDiv.innerHTML = `<h4>${member.name}</h4><p>${member.role}</p>`;
        teamMembersContainer.appendChild(memberDiv);
        memberDelay++;
      });

      setupScrollAnimations();
    }

    // --- 管理者ページ機能 ---

    function loadAdminContent() {
      const savedTopic = localStorage.getItem("adminDiscussionTopic");
      const savedNotes = localStorage.getItem("adminDiscussionNotes");
      const savedPoints = JSON.parse(localStorage.getItem("adminDiscussionPoints")) || [];
      const storedContent = JSON.parse(localStorage.getItem('mainContentData'));
      const storedIdeas = JSON.parse(localStorage.getItem('ideasData'));
      const storedTeamMembers = JSON.parse(localStorage.getItem('teamMembersData')); 

      if (savedTopic) discussionTopicInput.value = savedTopic;
      if (savedNotes) adminTextarea.value = savedNotes;
      renderDiscussionPoints(savedPoints);

      missionTextEditor.value = storedContent.mission;
      challengesTextEditor.value = storedContent.challenges;
      usageIntroEditor.value = storedContent.usageIntro;
      examplesIntroEditor.value = storedContent.examplesIntro;
      naganoDetailsEditor.value = storedContent.naganoDetails;

      siteTitleInput.value = storedContent.siteTitle;
      welcomeMessageInput.value = storedContent.welcomeMessage;
      renderUserList(JSON.parse(localStorage.getItem("adminUsers")) || ["ユーザーA", "ユーザーB", "ユーザーC"]);
      renderPendingContent(JSON.parse(localStorage.getItem("pendingContent")) || ["新規提案書", "イベント企画案"]);

      mfaStatusSpan.textContent = localStorage.getItem("mfaEnabled") === "true" ? "有効" : "無効";
      activeSessionsSpan.textContent = localStorage.getItem("activeSessions") || "1";
      recentLogCode.textContent = localStorage.getItem("recentLog") || "ログがありません";

      if (isAdvancedAdmin) {
          advancedAdminFeatures.forEach(feature => feature.style.display = 'block');
      } else {
          advancedAdminFeatures.forEach(feature => feature.style.display = 'none');
      }
      renderIdeaManagementLists(storedIdeas);
    }

    function renderDiscussionPoints(points) {
      discussionPointsList.innerHTML = "";
      points.forEach((point, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <span>${point}</span>
          <button data-index="${index}" aria-label="この議論ポイントを削除">&times;</button>
        `;
        discussionPointsList.appendChild(li);
      });
    }

    function renderUserList(users) {
        userList.innerHTML = "";
        users.forEach((user, index) => {
            const li = document.createElement("li");
            li.innerHTML = `
                <span>${user}</span>
                <button class="delete-user-btn" data-index="${index}" aria-label="このユーザーを削除">&times;</button>
            `;
            userList.appendChild(li);
        });
    }

    function renderPendingContent(contents) {
        pendingContentList.innerHTML = "";
        contents.forEach((content, index) => {
            const li = document.createElement("li");
            li.innerHTML = `
                <span>${content}</span>
                <button class="approve-content-btn" data-index="${index}" aria-label="このコンテンツを承認">承認</button>
            `;
            pendingContentList.appendChild(li);
        });
    }

    function renderIdeaManagementLists(ideas) {
      usageIdeasListAdmin.innerHTML = '';
      examplesIdeasListAdmin.innerHTML = '';

      ideas.forEach(idea => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${idea.title}</span>
          <div>
            <button class="edit-idea-btn" data-id="${idea.id}" data-type="${idea.type}" aria-label="このアイデアを編集">編集</button>
            <button class="delete-idea-btn" data-id="${idea.id}" data-type="${idea.type}" aria-label="このアイデアを削除">削除</button>
          </div>
        `;
        if (idea.type === 'usage') {
          usageIdeasListAdmin.appendChild(li);
        } else if (idea.type === 'examples') {
          examplesIdeasListAdmin.appendChild(li);
        }
      });
    }

    function showEditIdeaModal(id, type, title, description) {
      const modalHtml = `
        <div style="text-align: left; width: 100%;">
          <h4 class="text-xl font-semibold mb-4 text-blue-200" style="text-align: center;">アイデアを編集</h4>
          <label for="edit-idea-title" class="block mb-2 text-blue-200">タイトル:</label>
          <input type="text" id="edit-idea-title" class="w-full p-3 rounded-md bg-gray-800 text-white border border-gray-600 mb-4" value="${title}" aria-label="アイデアタイトルを編集">
          <label for="edit-idea-description" class="block mb-2 text-blue-200">説明:</label>
          <textarea id="edit-idea-description" class="editable-content-textarea" style="min-height: 120px;" rows="5" aria-label="アイデア説明を編集">${description}</textarea>
        </div>
      `;
      showConfirm(modalHtml, (result) => {
        if (result) {
          const editedTitle = document.getElementById('edit-idea-title').value;
          const editedDescription = document.getElementById('edit-idea-description').value;
          let ideas = JSON.parse(localStorage.getItem('ideasData'));
          const ideaIndex = ideas.findIndex(idea => idea.id === id && idea.type === type);
          if (ideaIndex !== -1) {
            ideas[ideaIndex] = { id, type, title: editedTitle, description: editedDescription };
            localStorage.setItem('ideasData', JSON.stringify(ideas));
            showAlert('アイデアが更新されました！');
            loadSiteContent();
            loadAdminContent();
          }
        }
      });
    }
    
    usageIdeasListAdmin.addEventListener('click', (e) => {
        if (e.target.closest('.edit-idea-btn')) editIdeaHandler(e.target.closest('.edit-idea-btn'));
        if (e.target.closest('.delete-idea-btn')) deleteIdeaHandler(e.target.closest('.delete-idea-btn'));
    });
    examplesIdeasListAdmin.addEventListener('click', (e) => {
        if (e.target.closest('.edit-idea-btn')) editIdeaHandler(e.target.closest('.edit-idea-btn'));
        if (e.target.closest('.delete-idea-btn')) deleteIdeaHandler(e.target.closest('.delete-idea-btn'));
    });


    function editIdeaHandler(button) {
      const id = button.dataset.id;
      const type = button.dataset.type;
      const ideas = JSON.parse(localStorage.getItem('ideasData'));
      const ideaToEdit = ideas.find(idea => idea.id === id && idea.type === type);
      if (ideaToEdit) {
        showEditIdeaModal(ideaToEdit.id, ideaToEdit.type, ideaToEdit.title, ideaToEdit.description);
      }
    }

    function deleteIdeaHandler(button) {
      const id = button.dataset.id;
      const type = button.dataset.type;
      showConfirm('このアイデアを削除しますか？', (result) => {
        if (result) {
          let ideas = JSON.parse(localStorage.getItem('ideasData'));
          ideas = ideas.filter(idea => !(idea.id === id && idea.type === type));
          localStorage.setItem('ideasData', JSON.stringify(ideas));
          showAlert('アイデアが削除されました！');
          loadSiteContent();
          loadAdminContent();
        }
      });
    }

    function openAdminPanel(e) {
        e.preventDefault();
        mainContent.style.display = "none";
        adminSection.style.display = "flex";
        adminPasswordContainer.style.display = "block";
        adminContent.style.display = "none";
        adminPasswordInput.value = "";
        adminMessage.style.display = "none";
        adminPasswordInput.focus();
        loadAdminContent();
    }

    adminLink.addEventListener("click", openAdminPanel);
    adminLinkMobile.addEventListener("click", (e) => {
        closeMobileMenu();
        openAdminPanel(e);
    });

    adminLoginBtn.addEventListener("click", () => {
      showLoading(adminLoginBtn);
      setTimeout(() => {
        const enteredPassword = adminPasswordInput.value.trim();
        // === パスワードをデコードして比較 ===
        if (enteredPassword === atob(P_A) || enteredPassword === atob(P_ADV)) {
          isAdvancedAdmin = (enteredPassword === atob(P_ADV));
          adminPasswordContainer.style.display = "none";
          adminContent.style.display = "flex";
          adminMessage.style.display = "none";
          document.getElementById("admin-textarea").focus();
          if (isAdvancedAdmin) {
            adminSection.classList.add("advanced-admin");
            showAlert("高度管理者モードでログインしました。");
          } else {
            adminSection.classList.remove("advanced-admin");
            showAlert("管理者としてログインしました。");
          }
          loadAdminContent();
        } else {
          adminMessage.style.display = "block";
        }
        hideLoading(adminLoginBtn);
      }, 1000);
    });

    adminPasswordInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        adminLoginBtn.click();
      }
    });

    adminBackBtn.addEventListener("click", () => {
      adminSection.style.display = "none";
      mainContent.style.display = "block";
      adminPasswordContainer.style.display = "block";
      adminContent.style.display = "none";
      adminMessage.style.display = "none";
      isAdvancedAdmin = false;
      discussionPointsList.innerHTML = "";
      userList.innerHTML = "";
      pendingContentList.innerHTML = "";
      usageIdeasListAdmin.innerHTML = "";
      examplesIdeasListAdmin.innerHTML = "";
      document.getElementById("mission").scrollIntoView({ behavior: 'smooth' });
      loadSiteContent();
    });

    saveNotesBtn.addEventListener("click", () => {
      localStorage.setItem("adminDiscussionTopic", discussionTopicInput.value);
      localStorage.setItem("adminDiscussionNotes", adminTextarea.value);
      showAlert("メモとテーマが保存されました！");
    });

    clearNotesBtn.addEventListener("click", () => {
      showConfirm("メモとテーマをクリアしますか？", (result) => {
        if (result) {
          discussionTopicInput.value = "";
          adminTextarea.value = "";
          localStorage.removeItem("adminDiscussionTopic");
          localStorage.removeItem("adminDiscussionNotes");
          showAlert("メモとテーマがクリアされました。");
        }
      });
    });

    addPointBtn.addEventListener("click", () => {
      const pointText = discussionPointInput.value.trim();
      if (pointText) {
        let savedPoints = JSON.parse(localStorage.getItem("adminDiscussionPoints")) || [];
        savedPoints.push(pointText);
        localStorage.setItem("adminDiscussionPoints", JSON.stringify(savedPoints));
        discussionPointInput.value = "";
        renderDiscussionPoints(savedPoints);
      } else {
        showAlert("議論ポイントを入力してください。");
      }
    });

    discussionPointsList.addEventListener("click", (e) => {
      if (e.target.tagName === "BUTTON" && e.target.hasAttribute("data-index")) {
        showConfirm("この議論ポイントを削除しますか？", (result) => {
          if (result) {
            const indexToRemove = parseInt(e.target.dataset.index);
            let savedPoints = JSON.parse(localStorage.getItem("adminDiscussionPoints")) || [];
            savedPoints.splice(indexToRemove, 1);
            localStorage.setItem("adminDiscussionPoints", JSON.stringify(savedPoints));
            renderDiscussionPoints(savedPoints);
            showAlert("議論ポイントが削除されました。");
          }
        });
      }
    });

    clearPointsBtn.addEventListener("click", () => {
      showConfirm("全ての議論ポイントをクリアしますか？", (result) => {
        if (result) {
          localStorage.removeItem("adminDiscussionPoints");
          renderDiscussionPoints([]);
          showAlert("全ての議論ポイントがクリアされました。");
        }
      });
    });

    saveMainContentBtn.addEventListener('click', () => {
      const currentContent = JSON.parse(localStorage.getItem('mainContentData'));
      currentContent.mission = missionTextEditor.value;
      currentContent.challenges = challengesTextEditor.value;
      currentContent.usageIntro = usageIntroEditor.value;
      currentContent.examplesIntro = examplesIntroEditor.value;
      currentContent.naganoDetails = naganoDetailsEditor.value;
      localStorage.setItem('mainContentData', JSON.stringify(currentContent));
      showAlert('主要コンテンツが保存されました！');
      loadSiteContent();
    });

    addUsageIdeaBtn.addEventListener('click', () => {
      const title = newUsageIdeaTitleInput.value.trim();
      const description = newUsageIdeaDescriptionInput.value.trim();
      if (title && description) {
        let ideas = JSON.parse(localStorage.getItem('ideasData'));
        const newId = 'u' + Date.now();
        ideas.push({ id: newId, type: 'usage', title, description });
        localStorage.setItem('ideasData', JSON.stringify(ideas));
        showAlert('新しい活用案が追加されました！');
        newUsageIdeaTitleInput.value = '';
        newUsageIdeaDescriptionInput.value = '';
        loadSiteContent();
        loadAdminContent();
      } else {
        showAlert('タイトルと説明の両方を入力してください。');
      }
    });

    addExampleIdeaBtn.addEventListener('click', () => {
      const title = newExampleIdeaTitleInput.value.trim();
      const description = newExampleIdeaDescriptionInput.value.trim();
      if (title && description) {
        let ideas = JSON.parse(localStorage.getItem('ideasData'));
        const newId = 'e' + Date.now();
        ideas.push({ id: newId, type: 'examples', title, description });
        localStorage.setItem('ideasData', JSON.stringify(ideas));
        showAlert('新しい活用事例が追加されました！');
        newExampleIdeaTitleInput.value = '';
        newExampleIdeaDescriptionInput.value = '';
        loadSiteContent();
        loadAdminContent();
      } else {
        showAlert('タイトルと説明の両方を入力してください。');
      }
    });

    updateSiteSettingsBtn.addEventListener("click", () => {
        const currentContent = JSON.parse(localStorage.getItem('mainContentData'));
        currentContent.siteTitle = siteTitleInput.value;
        currentContent.welcomeMessage = welcomeMessageInput.value;
        localStorage.setItem("mainContentData", JSON.stringify(currentContent));
        showAlert("サイト設定が更新されました！");
        loadSiteContent();
    });

    addUserBtn.addEventListener("click", () => {
        const userName = userNameInput.value.trim();
        if (userName) {
            let users = JSON.parse(localStorage.getItem("adminUsers")) || [];
            users.push(userName);
            localStorage.setItem("adminUsers", JSON.stringify(users));
            renderUserList(users);
            userNameInput.value = "";
            showAlert(`ユーザー「${userName}」が追加されました！`);
        } else {
            showAlert("ユーザー名を入力してください。");
        }
    });

    userList.addEventListener("click", (e) => {
        if (e.target.classList.contains("delete-user-btn")) {
            showConfirm("このユーザーを削除しますか？", (result) => {
                if (result) {
                    const indexToRemove = parseInt(e.target.dataset.index);
                    let users = JSON.parse(localStorage.getItem("adminUsers")) || [];
                    const userName = users[indexToRemove];
                    users.splice(indexToRemove, 1);
                    localStorage.setItem("adminUsers", JSON.stringify(users));
                    renderUserList(users);
                    showAlert(`ユーザー「${userName}」が削除されました！`);
                }
            });
        }
    });

    addPendingContentBtn.addEventListener("click", () => {
        const contentTitle = contentTitleInput.value.trim();
        if (contentTitle) {
            let contents = JSON.parse(localStorage.getItem("pendingContent")) || [];
            contents.push(contentTitle);
            localStorage.setItem("pendingContent", JSON.stringify(contents));
            renderPendingContent(contents);
            contentTitleInput.value = "";
            showAlert(`未承認コンテンツ「${contentTitle}」が追加されました！`);
        } else {
            showAlert("コンテンツタイトルを入力してください。");
        }
    });

    pendingContentList.addEventListener("click", (e) => {
        if (e.target.classList.contains("approve-content-btn")) {
            showConfirm("このコンテンツを承認しますか？", (result) => {
                if (result) {
                    const indexToRemove = parseInt(e.target.dataset.index);
                    let contents = JSON.parse(localStorage.getItem("pendingContent")) || [];
                    const contentTitle = contents[indexToRemove];
                    contents.splice(indexToRemove, 1);
                    localStorage.setItem("pendingContent", JSON.stringify(contents));
                    renderPendingContent(contents);
                    showAlert(`コンテンツ「${contentTitle}」が承認されました！`);
                }
            });
        }
    });

    enableMfaBtn.addEventListener("click", () => {
      showConfirm("二要素認証を有効にしますか？", (result) => {
        if (result) {
          localStorage.setItem("mfaEnabled", "true");
          mfaStatusSpan.textContent = "有効";
          showAlert("二要素認証が有効になりました。");
        }
      });
    });

    terminateSessionBtn.addEventListener("click", () => {
      showConfirm("全てのアクティブセッションを終了しますか？", (result) => {
        if (result) {
          localStorage.setItem("activeSessions", "1");
          activeSessionsSpan.textContent = "1";
          showAlert("全セッションが終了されました。");
        }
      });
    });

    viewLogBtn.addEventListener("click", () => {
      const dummyLog = `[${new Date().toLocaleString()}] User 'admin' logged in.`;
      localStorage.setItem("recentLog", dummyLog);
      recentLogCode.textContent = dummyLog;
      showAlert("最新のシステムログを表示しました。");
    });

    exportDataBtn.addEventListener("click", () => {
      const data = {
        mainContent: JSON.parse(localStorage.getItem('mainContentData')),
        ideas: JSON.parse(localStorage.getItem('ideasData')),
        team: JSON.parse(localStorage.getItem('teamMembersData')),
        adminDiscussionTopic: localStorage.getItem('adminDiscussionTopic'),
        adminDiscussionNotes: localStorage.getItem('adminDiscussionNotes'),
        adminDiscussionPoints: JSON.parse(localStorage.getItem('adminDiscussionPoints')) || [],
        adminUsers: JSON.parse(localStorage.getItem('adminUsers')) || [],
        pendingContent: JSON.parse(localStorage.getItem('pendingContent')) || []
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'site-data.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    importDataInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (evt) => {
          try {
            const data = JSON.parse(evt.target.result);
            if (data.mainContent) localStorage.setItem('mainContentData', JSON.stringify(data.mainContent));
            if (data.ideas) localStorage.setItem('ideasData', JSON.stringify(data.ideas));
            if (data.team) localStorage.setItem('teamMembersData', JSON.stringify(data.team));
            if ('adminDiscussionTopic' in data) localStorage.setItem('adminDiscussionTopic', data.adminDiscussionTopic || '');
            if ('adminDiscussionNotes' in data) localStorage.setItem('adminDiscussionNotes', data.adminDiscussionNotes || '');
            if ('adminDiscussionPoints' in data) localStorage.setItem('adminDiscussionPoints', JSON.stringify(data.adminDiscussionPoints || []));
            if ('adminUsers' in data) localStorage.setItem('adminUsers', JSON.stringify(data.adminUsers || []));
            if ('pendingContent' in data) localStorage.setItem('pendingContent', JSON.stringify(data.pendingContent || []));
            showAlert('データをインポートしました！');
            loadSiteContent();
            loadAdminContent();
          } catch(err) {
            showAlert('インポートに失敗しました。');
          }
        };
        reader.readAsText(file);
      }
      e.target.value = '';
    });

    const contactForm = document.getElementById('contact-form');
    const formMessage = document.getElementById('form-message');

    contactForm.addEventListener('submit', function(e) {
      e.preventDefault();
      showLoading(contactSubmitBtn);
      setTimeout(() => {
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const message = document.getElementById('message').value;

        if (!name || !email || !message) {
          formMessage.style.display = 'block';
          formMessage.style.color = '#ef4444';
          formMessage.textContent = '全ての必須項目を入力してください。';
        } else {
          formMessage.style.display = 'block';
          formMessage.style.color = '#a7f3d0';
          formMessage.textContent = 'お問い合わせありがとうございます！メッセージが送信されました。';
          contactForm.reset();
        }
        hideLoading(contactSubmitBtn);
      }, 1500);
    });

    document.querySelectorAll('#contact-form input, #contact-form textarea').forEach(input => {
      input.addEventListener('input', () => {
        formMessage.style.display = 'none';
      });
    });

    const scrollToTopBtn = document.getElementById("scrollToTopBtn");

    window.onscroll = function() {
      if (adminSection.style.display === "flex") {
        scrollToTopBtn.style.display = "none";
      } else if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
        scrollToTopBtn.style.display = "block";
      } else {
        scrollToTopBtn.style.display = "none";
      }
    };

    scrollToTopBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    document.querySelectorAll('#desktop-nav a:not(#adminLink)').forEach(link => {
      link.addEventListener('click', (e) => {
        if (adminSection.style.display === 'flex') {
          e.preventDefault();
          mainContent.style.display = 'block';
          adminSection.style.display = 'none';
          const targetId = link.getAttribute('href');
          if (targetId && targetId.startsWith('#')) {
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth' });
            }
          }
        }
      });
    });

    // --- スクロールアニメーションのロジック ---
    const setupScrollAnimations = () => {
        const animatedItems = document.querySelectorAll('.animated-item');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    // 一度表示されたら監視を停止
                    observer.unobserve(entry.target);
                }
            });
        }, {
            threshold: 0.1 // 10%表示されたら発火
        });

        animatedItems.forEach(item => {
            observer.observe(item);
        });
    };

    // --- モバイルメニューのロジック ---
    function closeMobileMenu() {
        mobileMenu.classList.remove('is-open');
        hamburgerBtn.classList.remove('is-active');
        hamburgerBtn.setAttribute('aria-expanded', 'false');
        document.body.classList.remove('menu-open');
    }

    hamburgerBtn.addEventListener('click', () => {
        const isOpen = mobileMenu.classList.toggle('is-open');
        hamburgerBtn.classList.toggle('is-active');
        hamburgerBtn.setAttribute('aria-expanded', isOpen);
        document.body.classList.toggle('menu-open');
    });

    mobileMenuLinks.forEach(link => {
        if (link.id !== 'adminLinkMobile') {
            link.addEventListener('click', () => {
                closeMobileMenu();
            });
        }
    });

    // --- パスワード表示切り替えのロジック ---
    passwordToggleIcon.addEventListener('mousedown', () => {
        adminPasswordInput.type = 'text';
    });
    passwordToggleIcon.addEventListener('mouseup', () => {
        adminPasswordInput.type = 'password';
    });
    passwordToggleIcon.addEventListener('mouseleave', () => {
        adminPasswordInput.type = 'password';
    });
    // For mobile
    passwordToggleIcon.addEventListener('touchstart', (e) => {
        e.preventDefault();
        adminPasswordInput.type = 'text';
    });
    passwordToggleIcon.addEventListener('touchend', () => {
        adminPasswordInput.type = 'password';
    });


    window.onload = () => {
      initializeContent();
      loadSiteContent();
      // コンテンツがロードされた後にアニメーションを設定
      setupScrollAnimations();
    };
  </script>
</body>
</html>
